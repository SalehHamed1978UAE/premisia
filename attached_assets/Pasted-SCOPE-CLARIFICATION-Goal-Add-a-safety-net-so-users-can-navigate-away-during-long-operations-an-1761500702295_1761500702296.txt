SCOPE CLARIFICATION

  Goal: Add a safety net so users can navigate away during long operations
  and return later.

  What we're building: Hybrid approach (not pure background jobs)

  Keep Existing (Don't Touch):

  - âœ… Current progress bars and live updates
  - âœ… SSE streaming (BMC, Web Research)
  - âœ… User stays on page watching progress
  - âœ… Immediate result display
  - âœ… All existing UI/UX flows

  Add New (Safety Net):

  - âœ… Track operations in database
  - âœ… If user navigates away, job continues
  - âœ… When user returns, show "Operation completed" or "Still running (75%)"
  - âœ… Optional jobs dashboard to see what's running

  ---
  ğŸ¯ Implementation: Minimal Changes

  Read BACKGROUND_JOBS_HYBRID_APPROACH.md - it has the revised plan.

  Key changes:
  1. Add job tracking when operations start
  2. Update job records as progress happens (alongside existing SSE)
  3. Add reconnection check when user returns to a page
  4. Keep all existing behavior intact

  Time: 2-3 hours (not 4-5) since we're just adding tracking, not rebuilding
  execution.

  ---
  ğŸ“ What You Need to Do:

  Phase 1: Database & Service (1 hour)

  1. Create background_jobs table (same as before)
  2. Create BackgroundJobService (same as before)
  3. Add API routes for job status

  Phase 2: Add Job Tracking to Existing Endpoints (1 hour)

  Update endpoints like POST /generate-epm:
  // Before synthesis
  const jobId = await backgroundJobService.createJob({...});

  // During synthesis (alongside existing SSE)
  onProgress: (progress, msg) => {
    backgroundJobService.updateJob(jobId, { progress, message });
    // ALSO keep existing SSE/progress updates
  }

  // After synthesis
  await backgroundJobService.updateJob(jobId, { status: 'completed',
  resultData });

  Phase 3: Frontend Reconnection (30 min)

  When user returns to a page:
  useEffect(() => {
    // Check if there's a running job for this session
    const job = await checkRunningJob(sessionId);
    if (job?.status === 'running') {
      // Resume watching it
      setShowProgress(true);
    }
  }, []);

  Phase 4: Optional Jobs Dashboard (30 min)

  Simple page showing:
  - Currently running jobs
  - Recently completed jobs
  - Failed jobs

  ---
  âœ… Success Looks Like:

  Test 1: User starts EPM generation
  - âœ… Progress bar shows up (existing)
  - âœ… User watches it complete (existing)
  - âœ… Job is tracked in database (new)

  Test 2: User starts EPM generation, then navigates away
  - âœ… User clicks browser back button
  - âœ… Job continues running in background
  - âœ… User returns 2 minutes later
  - âœ… Page shows "Still running (85%)" or "Completed!"

  Test 3: User goes to /jobs page
  - âœ… Sees list of operations (running, completed, failed)
  - âœ… Can click to view results

  ---
  ğŸš« What We're NOT Doing:

  âŒ Replacing SSE with polling (keep SSE!)
  âŒ Changing any existing UI (keep progress bars!)
  âŒ Building job queue/workers (not needed!)
  âŒ Removing live updates (keep them!)

  ---
  ğŸ¬ Start Here:

  1. Read BACKGROUND_JOBS_HYBRID_APPROACH.md (full details)
  2. Implement Phase 1: Database & Service (1 hour)
  3. Implement Phase 2: Add tracking to 1-2 endpoints (1 hour)
  4. Test navigation recovery
  5. (Optional) Add jobs dashboard

  Questions? The hybrid approach doc has code examples for everything.